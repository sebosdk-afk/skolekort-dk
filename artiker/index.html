<!doctype html>
<html lang="da">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Artikler – danskefolkeskoler.dk</title>
  <link rel="stylesheet" href="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css">
  <style>
    :root{
      --bg:#0b1020; --panel:#121736; --border:rgba(255,255,255,.10);
      --muted:#aab2d5; --text:#e7eaf6; --chip:#1a2146; --line:#2b335a;
      --link:#9ab6ff; --accent:#5b8cff;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    header{display:flex;align-items:center;gap:12px;justify-content:space-between;padding:14px 16px;border-bottom:1px solid var(--border);position:sticky;top:0;background:rgba(11,16,32,.85);backdrop-filter:blur(8px);z-index:5}
    .logo{display:flex;align-items:center;gap:10px;font-weight:700}
    .logo svg{width:22px;height:22px}
    .crumbs{font-size:12px;color:var(--muted)}
    .wrap{max-width:1100px;margin:0 auto;padding:16px}
    .toolbar{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:12px}
    input,select{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.16);color:var(--text);padding:10px 12px;border-radius:10px}
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
    @media (max-width: 980px){.grid{grid-template-columns:1fr}}
    .card{background:var(--panel);border:1px solid var(--border);border-radius:12px;padding:14px;display:flex;flex-direction:column;gap:8px}
    .meta{display:flex;gap:8px;flex-wrap:wrap}
    .chip{font-size:12px;border:1px solid var(--line);background:var(--chip);border-radius:999px;padding:6px 10px;color:#d9def7}
    .title{font-weight:700;font-size:16px;line-height:1.25}
    .title a{color:var(--link);text-decoration:none}
    .title a:hover{text-decoration:underline}
    .desc{font-size:13px;color:#d7dcfa}
    .muted{font-size:12px;color:var(--muted)}
    .source{font-size:12px;color:#b8c4ff}
    .toplinks a{color:var(--link);text-decoration:none;border:1px solid rgba(255,255,255,.16);padding:6px 10px;border-radius:8px}
  </style>
</head>
<body>
  <header>
    <div class="logo">
      <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <rect x="2" y="5" width="20" height="14" rx="3" ry="3" stroke="#9db6ff" stroke-width="1.6"/>
        <path d="M5 9h6M5 12h10M5 15h8" stroke="#9db6ff" stroke-width="1.6" stroke-linecap="round"/>
      </svg>
      <span>danskefolkeskoler.dk</span>
    </div>
    <div class="crumbs">Artikler</div>
    <div class="toplinks"><a href="/">Tilbage til kort</a></div>
  </header>

  <main class="wrap">
    <div class="toolbar">
      <input id="q" placeholder="Søg emne, kilde, ord...">
      <select id="source"><option value="">Alle kilder</option></select>
      <select id="topic"><option value="">Alle emner</option></select>
      <select id="sort">
        <option value="new">Nyeste først</option>
        <option value="old">Ældste først</option>
        <option value="az">Titel A–Å</option>
      </select>
    </div>

    <div id="count" class="muted">0 artikler</div>
    <div id="grid" class="grid"></div>
  </main>

  <script>
    const DATA_URL = '/data/articles.json';
    let ALL = [];

    const $ = id => document.getElementById(id);
    const q=$('q'), source=$('source'), topic=$('topic'), sortSel=$('sort'), grid=$('grid'), count=$('count');

    fetch(DATA_URL, {cache:'no-store'})
      .then(r => r.json())
      .then(data => { ALL = (data.items||[]).map(n=>({
        ...n,
        _t: (n.title||'').toLowerCase() + ' ' + (n.summary||'').toLowerCase() + ' ' + (n.source||'').toLowerCase() + ' ' + (n.topic||'').toLowerCase()
      })); boot(); })
      .catch(err => { console.error(err); grid.innerHTML = '<div class="muted">Kunne ikke hente artikler.</div>'; });

    function boot(){
      // Kilder og emner
      const sources = Array.from(new Set(ALL.map(a=>a.source).filter(Boolean))).sort();
      sources.forEach(s=>{ const o=document.createElement('option'); o.value=s; o.textContent=s; source.appendChild(o); });

      const topics = Array.from(new Set(ALL.flatMap(a=>Array.isArray(a.topic)?a.topic:[a.topic]).filter(Boolean))).sort();
      topics.forEach(t=>{ const o=document.createElement('option'); o.value=t; o.textContent=t; topic.appendChild(o); });

      [q, source, topic, sortSel].forEach(el => el.addEventListener('input', render));
      render();
    }

    function render(){
      const query = q.value.trim().toLowerCase();
      const src = source.value;
      const tpc = topic.value;
      const ord = sortSel.value;

      let rows = ALL.filter(a =>
        (!query || a._t.includes(query)) &&
        (!src   || a.source === src) &&
        (!tpc   || (Array.isArray(a.topic) ? a.topic.includes(tpc) : a.topic === tpc))
      );

      if (ord === 'new') rows.sort((a,b)=>new Date(b.date)-new Date(a.date));
      else if (ord === 'old') rows.sort((a,b)=>new Date(a.date)-new Date(b.date));
      else if (ord === 'az') rows.sort((a,b)=>String(a.title||'').localeCompare(String(b.title||'')));

      count.textContent = rows.length + (rows.length===1?' artikel':' artikler');

      grid.innerHTML = rows.map(a => card(a)).join('');
    }

    function card(a){
      const date = a.date ? new Date(a.date) : null;
      const dstr = date ? date.toLocaleDateString('da-DK', { year:'numeric', month:'short', day:'2-digit' }) : '';
      const topics = Array.isArray(a.topic) ? a.topic : (a.topic ? [a.topic] : []);
      return `
        <article class="card">
          <div class="title"><a href="${a.url}" target="_blank" rel="noopener">${escapeHtml(a.title||'Uden titel')}</a></div>
          <div class="meta">
            ${a.source ? `<span class="chip">${escapeHtml(a.source)}</span>`:''}
            ${dstr ? `<span class="chip">${dstr}</span>`:''}
            ${topics.map(t=>`<span class="chip">${escapeHtml(t)}</span>`).join('')}
          </div>
          ${a.summary ? `<div class="desc">${escapeHtml(a.summary)}</div>`:''}
          ${a.author ? `<div class="muted">Af ${escapeHtml(a.author)}</div>`:''}
        </article>`;
    }

    function escapeHtml(s){return String(s||'').replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m]));}
  </script>
</body>
</html>
